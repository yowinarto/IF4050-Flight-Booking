# PPLS Flight Booking Service

## Anggota Kelompok
Afif Bambang P.       - 13515058

Winarto               - 13515061

Gianfranco Fertino H. - 13515118

## Entity Centric Service

### Source
```./entity_service```

## Task Centric Services

### Source
```./FlightBookingService```

### SOAP Wrapper
```./flight-booking-soap```

### Payment Gateway Middleware
```./payment-gateway-integration```

## Camunda BPM Process Application
A Process Application for [Camunda BPM](http://docs.camunda.org).

This project has been generated by the Maven archetype
[camunda-archetype-servlet-war-7.9.2](http://docs.camunda.org/latest/guides/user-guide/#process-applications-maven-project-templates-archetypes).

## BPMN
[Apply Promo Process](src/main/resources/applypromo.bpmn)

[Booking Ticket Process](src/main/resources/bookingservice.bpmn)

[Cancel Ticket Process](src/main/resources/cancelticket.bpmn)

## How to use it?

### Deployment to an Application Server
You can also build and deploy the process application to an application server.
For an easy start you can download Apache Tomcat with a pre-installed Camunda
from our [Download Page](https://camunda.com/download/).

#### Manually
1. Build the application using:
```bash
mvn clean package
```
2. Copy the *.war file from the `target` directory to the deployment directory
of your application server e.g. `tomcat/webapps` or `wildfly/standalone/deployments`.
For a faster 1-click (re-)deployment see the alternatives below.

#### Apache Tomcat (using Maven AntRun Plugin)
1. First copy the file `build.properties.example` to `build.properties`
2. Edit the `build.properties` file and put the path to your Tomcat into `deploy.tomcat.dir`.
3. Build and deploy the process application using:
```bash
mvn clean package antrun:run
```

Alternatively, you can also copy the `build.properties` file to `${user.home}/.camunda/build.properties`
to have a central configuration that works with all projects generated by the
[Camunda Maven Archetypes](http://docs.camunda.org/latest/guides/user-guide/#process-applications-maven-project-templates-archetypes) e.g. the [examples provided by the Camunda Consulting Team](https://github.com/camunda-consulting/code).

#### Apache Tomcat (using Tomcat Maven Plugin)
1. Create a user in Tomcat with the role `manager-script`.
2. Add the user's credentials to the `tomcat7-maven-plugin` configuration in the [pom.xml](pom.xml) file.
3. Build and deploy the process application using:
```bash
mvn clean tomcat7:deploy
```

#### Wildfly (using Wildfly Maven Plugin)
1. Build and deploy the process application using:
```bash
mvn clean wildfly:deploy
```

#### JBoss AS7 (using JBoss AS Maven Plugin)
1. Build and deploy the process application using:
```bash
mvn clean jboss-as:deploy
```

#### Ant (and Maven)
1. First copy the file `build.properties.example` to `build.properties`
2. Edit the `build.properties` file and put the path to your application server inside it.
3. Build and deploy the process application using:
```bash
ant deploy.tomcat
```
or
```bash
ant deploy.jboss
```

Alternatively, you can also copy the `build.properties` file to `${user.home}/.camunda/build.properties`
to have a central configuration that works with all projects generated by the
[Camunda Maven Archetypes](http://docs.camunda.org/latest/guides/user-guide/#process-applications-maven-project-templates-archetypes) e.g. the [examples provided by the Camunda Consulting Team](https://github.com/camunda-consulting/code).

### Run and Inspect with Tasklist and Cockpit
Once you deployed the application you can run it using
[Camunda Tasklist](http://docs.camunda.org/latest/guides/user-guide/#tasklist)
and inspect it using
[Camunda Cockpit](http://docs.camunda.org/latest/guides/user-guide/#cockpit).

### Send Request
#### Manually start process in camunda
1. POST request to
```
http://178.128.80.25:8080/engine-rest/message
``` 

2. Set Content-Type to application/json with body

**Apply Promo**
```
{
  "messageName" : "Apply Promo",
  "businessKey" : "12345",
  "processVariables" : {
    "promoCode" : {
        "value" : "BAKULBDG",
        "type": "String"
    },
    "bookingId" : {
      "value" : 2,
      "type": "Integer"
    }
  },
  "resultEnabled" : true 
}
```

**Booking Ticket**
```
{
  "messageName" : "Booking Ticket",
  "businessKey" : "12345",
  "processVariables" : {
    "numOfPassenger" : {
        "value" : 1,
        "type": "Integer"
    },
    "passengerId" : {
      "value" : 1,
      "type": "Integer"
    },
    "flightId" : {
      "value" : 2,
      "type": "Integer"
    }
  },
  "resultEnabled" : true 
}
```

**Cancel Booking**
```
{
  "messageName" : "Cancel Booking",
  "businessKey" : "12345",
  "processVariables" : {
    "bookingId" : {
      "value" : 2,
      "type": "Integer"
    }
  },
  "resultEnabled" : true 
}
```
#### Start process from SOAP Wrapper
1. POST request to

**Apply Promo**
```
http://174.138.18.246:8080/flight-booking-soap-wrapper/flight/apply-promo
``` 

**Booking Ticket**
```
http://174.138.18.246:8080/flight-booking-soap-wrapper/flight/booking
``` 

**Cancel Booking**
```
http://174.138.18.246:8080/flight-booking-soap-wrapper/flight/cancel-booking
``` 

2. Set Content-Type to text/xml with body

**Apply Promo**
```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:bs="http://flightbooking.com/flight-booking-soap">
    <soapenv:Header/>
    <soapenv:Body>
        <bs:postPromoRequest>
            <bs:promoData>
                <bs:promoCode>BAKULBDG</bs:promoCode>
                <bs:bookingId>2</bs:bookingId>
            </bs:promoData>
        </bs:postPromoRequest>
    </soapenv:Body>
</soapenv:Envelope>
```

**Booking Ticket**
```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:bs="http://flightbooking.com/flight-booking-soap">
    <soapenv:Header/>
    <soapenv:Body>
        <bs:postBookingRequest>
            <bs:bookingData>
                <bs:numOfPassenger>2</bs:numOfPassenger>
                <bs:passengerId>1</bs:passengerId>
                <bs:flightId>1</bs:flightId>
            </bs:bookingData>
        </bs:postBookingRequest>
    </soapenv:Body>
</soapenv:Envelope>
```

**Cancel Booking**
```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:bs="http://flightbooking.com/flight-booking-soap">
    <soapenv:Header/>
    <soapenv:Body>
        <bs:postCancelBookingRequest>
            <bs:bookingId>5</bs:bookingId>
        </bs:postCancelBookingRequest>
    </soapenv:Body>
</soapenv:Envelope>
```


## License
[Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0).

<!-- HTML snippet for index page
  <tr>
    <td><img src="snippets/FlightBookingService/src/main/resources/process.png" width="100"></td>
    <td><a href="snippets/FlightBookingService">Camunda BPM Process Application</a></td>
    <td>A Process Application for [Camunda BPM](http://docs.camunda.org).</td>
  </tr>
-->
<!-- Tweet
New @Camunda example: Camunda BPM Process Application - A Process Application for [Camunda BPM](http://docs.camunda.org). https://github.com/camunda-consulting/code/tree/master/snippets/FlightBookingService
-->